generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x", "linux-arm64-openssl-1.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model users {
  id                 String             @id @default(uuid()) @db.Uuid
  phone              String             @unique
  phone_confirmed    Boolean            @default(false)
  type               String?
  allow_order        Boolean            @default(false)
  is_active          Boolean            @default(false)
  created_at         DateTime           @default(now())
  updated_at         DateTime           @default(now())
  companies          company[]
  delivery_addresses delivery_address[]
  last_events        last_event[]
  orders             order[]

  @@index([phone], name: "index_users_on_phone")
  @@index([phone_confirmed], name: "index_users_on_phone_confirmed")
  @@index([type], name: "index_users_on_type")
  @@index([allow_order], name: "index_users_on_allow_order")
  @@index([is_active], name: "index_users_on_is_active")
  @@index([created_at], name: "index_users_on_created_at")
  @@index([updated_at], name: "index_users_on_updated_at")
}

model last_event {
  id         String   @id @default(uuid()) @db.Uuid
  type       String
  user_id    String?  @db.Uuid
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  users      users?   @relation(fields: [user_id], references: [id])

  @@index([type], name: "index_last_event_on_type")
  @@index([user_id], name: "index_last_event_on_user_id")
  @@index([created_at], name: "index_last_event_on_created_at")
  @@index([updated_at], name: "index_last_event_on_updated_at")
}

model phone_confirmation {
  id         String    @id @default(uuid()) @db.Uuid
  phone      String
  code       String
  ip         String
  used_at    DateTime?
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())

  @@index([phone], name: "index_phone_confirmation_on_phone")
  @@index([code], name: "index_phone_confirmation_on_code")
  @@index([ip], name: "index_phone_confirmation_on_ip")
  @@index([used_at], name: "index_phone_confirmation_on_used_at")
  @@index([created_at], name: "index_phone_confirmation_on_created_at")
  @@index([updated_at], name: "index_phone_confirmation_on_updated_at")
}

model company {
  id         String   @id @default(uuid()) @db.Uuid
  code       String
  name       String
  address    String
  user_id    String?  @db.Uuid
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  users      users?   @relation(fields: [user_id], references: [id])
  orders     order[]

  @@index([code], name: "index_company_on_code")
  @@index([name], name: "index_company_on_name")
  @@index([address], name: "index_company_on_address")
  @@index([user_id], name: "index_company_on_user_id")
  @@index([created_at], name: "index_company_on_created_at")
  @@index([updated_at], name: "index_company_on_updated_at")
}

model delivery_address {
  id         String    @id @default(uuid()) @db.Uuid
  address    String
  geo_code   String
  last_used  DateTime?
  comment    String?
  phone      String
  user_id    String?   @db.Uuid
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  users      users?    @relation(fields: [user_id], references: [id])

  @@index([address], name: "index_delivery_address_on_address")
  @@index([geo_code], name: "index_delivery_address_on_geo_code")
  @@index([last_used], name: "index_delivery_address_on_last_used")
  @@index([comment], name: "index_delivery_address_on_comment")
  @@index([phone], name: "index_delivery_address_on_phone")
  @@index([user_id], name: "index_delivery_address_on_user_id")
  @@index([created_at], name: "index_delivery_address_on_created_at")
  @@index([updated_at], name: "index_delivery_address_on_updated_at")
}

model order {
  id             String       @id @default(uuid()) @db.Uuid
  number         Int
  status         String
  comment        String?
  address        String
  delivery_at    DateTime?
  delivery_price Decimal?
  discount       Decimal?
  total          Decimal?
  user_id        String       @db.Uuid
  company_id     String       @db.Uuid
  vendor_id      String       @db.Uuid
  created_at     DateTime     @default(now())
  updated_at     DateTime     @default(now())
  company        company      @relation(fields: [company_id], references: [id])
  users          users        @relation(fields: [user_id], references: [id])
  vendor         vendor       @relation(fields: [vendor_id], references: [id])
  order_items    order_item[]

  @@index([number], name: "index_order_on_number")
  @@index([status], name: "index_order_on_status")
  @@index([comment], name: "index_order_on_comment")
  @@index([address], name: "index_order_on_address")
  @@index([delivery_at], name: "index_order_on_delivery_at")
  @@index([delivery_price], name: "index_order_on_delivery_price")
  @@index([discount], name: "index_order_on_discount")
  @@index([total], name: "index_order_on_total")
  @@index([user_id], name: "index_order_on_user_id")
  @@index([company_id], name: "index_order_on_company_id")
  @@index([vendor_id], name: "index_order_on_vendor_id")
  @@index([created_at], name: "index_order_on_created_at")
  @@index([updated_at], name: "index_order_on_updated_at")
}

model vendor {
  id              String           @id @default(uuid()) @db.Uuid
  name            String
  slug            String?
  payment         String
  delivery        String
  description     String
  working_hours   Int
  rating          Int
  created_at      DateTime         @default(now())
  updated_at      DateTime         @default(now())
  orders          order[]
  vendor_products vendor_product[]

  @@index([name], name: "index_vendor_on_name")
  @@index([slug], name: "index_vendor_on_slug")
  @@index([payment], name: "index_vendor_on_payment")
  @@index([delivery], name: "index_vendor_on_delivery")
  @@index([description], name: "index_vendor_on_description")
  @@index([working_hours], name: "index_vendor_on_working_hours")
  @@index([rating], name: "index_vendor_on_rating")
  @@index([created_at], name: "index_vendor_on_created_at")
  @@index([updated_at], name: "index_vendor_on_updated_at")
}

model brand {
  id         String    @id @default(uuid()) @db.Uuid
  name       String
  slug       String?
  is_active  Boolean   @default(false)
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  products   product[]

  @@index([name], name: "index_brand_on_name")
  @@index([slug], name: "index_brand_on_slug")
  @@index([is_active], name: "index_brand_on_is_active")
  @@index([created_at], name: "index_brand_on_created_at")
  @@index([updated_at], name: "index_brand_on_updated_at")
}

model product {
  id                String             @id @default(uuid()) @db.Uuid
  name              String
  slug              String?
  description       String
  price             Decimal
  photo             String?
  weight            Int
  is_active         Boolean            @default(false)
  brand_id          String             @db.Uuid
  created_at        DateTime           @default(now())
  updated_at        DateTime           @default(now())
  brand             brand              @relation(fields: [brand_id], references: [id])
  category_products category_product[]
  order_items       order_item[]
  vendor_products   vendor_product[]

  @@index([name], name: "index_product_on_name")
  @@index([slug], name: "index_product_on_slug")
  @@index([description], name: "index_product_on_description")
  @@index([price], name: "index_product_on_price")
  @@index([photo], name: "index_product_on_photo")
  @@index([weight], name: "index_product_on_weight")
  @@index([is_active], name: "index_product_on_is_active")
  @@index([brand_id], name: "index_product_on_brand_id")
  @@index([created_at], name: "index_product_on_created_at")
  @@index([updated_at], name: "index_product_on_updated_at")
}

model vendor_product {
  id         String   @id @default(uuid()) @db.Uuid
  price      Decimal
  min_count  Int
  unit       Int
  vendor_id  String   @db.Uuid
  product_id String   @db.Uuid
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  product    product  @relation(fields: [product_id], references: [id])
  vendor     vendor   @relation(fields: [vendor_id], references: [id])

  @@index([price], name: "index_vendor_product_on_price")
  @@index([min_count], name: "index_vendor_product_on_min_count")
  @@index([unit], name: "index_vendor_product_on_unit")
  @@index([vendor_id], name: "index_vendor_product_on_vendor_id")
  @@index([product_id], name: "index_vendor_product_on_product_id")
  @@index([created_at], name: "index_vendor_product_on_created_at")
  @@index([updated_at], name: "index_vendor_product_on_updated_at")
}

model order_item {
  id         String   @id @default(uuid()) @db.Uuid
  price      Decimal
  count      Int
  order_id   String   @db.Uuid
  product_id String   @db.Uuid
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  order      order    @relation(fields: [order_id], references: [id])
  product    product  @relation(fields: [product_id], references: [id])

  @@index([price], name: "index_order_item_on_price")
  @@index([count], name: "index_order_item_on_count")
  @@index([order_id], name: "index_order_item_on_order_id")
  @@index([product_id], name: "index_order_item_on_product_id")
  @@index([created_at], name: "index_order_item_on_created_at")
  @@index([updated_at], name: "index_order_item_on_updated_at")
}

model category {
  id                String             @id @default(uuid()) @db.Uuid
  sub_id            String             @db.Uuid
  name              String
  slug              String?
  icon              String?
  priority          Int?
  is_active         Boolean            @default(false)
  created_at        DateTime           @default(now())
  updated_at        DateTime           @default(now())
  category_products category_product[]

  @@index([sub_id], name: "index_category_on_sub_id")
  @@index([name], name: "index_category_on_name")
  @@index([slug], name: "index_category_on_slug")
  @@index([icon], name: "index_category_on_icon")
  @@index([priority], name: "index_category_on_priority")
  @@index([is_active], name: "index_category_on_is_active")
  @@index([created_at], name: "index_category_on_created_at")
  @@index([updated_at], name: "index_category_on_updated_at")
}

model category_product {
  id          String   @id @default(uuid()) @db.Uuid
  sub_id      String   @db.Uuid
  is_active   Boolean  @default(false)
  category_id String   @db.Uuid
  product_id  String   @db.Uuid
  created_at  DateTime @default(now())
  updated_at  DateTime @default(now())
  category    category @relation(fields: [category_id], references: [id])
  product     product  @relation(fields: [product_id], references: [id])

  @@index([sub_id], name: "index_category_product_on_sub_id")
  @@index([is_active], name: "index_category_product_on_is_active")
  @@index([category_id], name: "index_category_product_on_category_id")
  @@index([product_id], name: "index_category_product_on_product_id")
  @@index([created_at], name: "index_category_product_on_created_at")
  @@index([updated_at], name: "index_category_product_on_updated_at")
}
