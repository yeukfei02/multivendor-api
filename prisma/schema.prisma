generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL_DEV")
}

model users {
  id                 String             @id @default(uuid()) @db.Uuid
  phone              String             @unique
  phone_confirmed    Boolean            @default(false)
  type               String?
  allow_order        Boolean            @default(false)
  is_active          Boolean            @default(false)
  created_at         DateTime           @default(now())
  updated_at         DateTime           @default(now())
  company            company?
  delivery_addresses delivery_address[]
  last_events        last_event[]

  @@index([phone, phone_confirmed, type, allow_order, is_active])
}

model last_event {
  id         String   @id @default(uuid()) @db.Uuid
  type       String
  user_id    String?  @db.Uuid
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  users      users?   @relation(fields: [user_id], references: [id])

  @@index([type, user_id])
}

model phone_confirmation {
  id         String    @id @default(uuid()) @db.Uuid
  phone      String
  code       String
  ip         String
  used_at    DateTime?
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())

  @@index([phone, code, ip, used_at])
}

model company {
  id         String   @id @default(uuid()) @db.Uuid
  code       String
  name       String
  address    String
  user_id    String?  @unique @db.Uuid
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  users      users?   @relation(fields: [user_id], references: [id])

  @@index([code, name, address, user_id])
}

model delivery_address {
  id         String    @id @default(uuid()) @db.Uuid
  address    String
  geo_code   String
  last_used  DateTime?
  comment    String?
  phone      String
  user_id    String?   @db.Uuid
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  users      users?    @relation(fields: [user_id], references: [id])

  @@index([address, geo_code, last_used, comment, phone, user_id])
}
